# Первые шаги {#first_steps}


ываыв
а
ываыв

## Установка софта {#installation}

Казалось бы, чего проще --- поставить программу?! Однако не всегда всё идёт гладко. 

Самая распространённая проблема, с которой мне доводилось бороться на разных компьютерах, --- это русские буквы и пробелы в названиях файлов и папок под Windows. 

Заповедь 1. Если ты используешь Windows, то никогда при серьёзной работе не используй русские буквы и пробелы в названиях файлов и папок. Папку с котиками можно назвать `мои котики` :)

Заповедь 1 легко нарушить даже не осознавая этого. Если имя пользователя Windows написано русскими буквами, например, `Машенька`, то все документы этого пользователя будут находиться в папке `C:/Users/Машенька/Documents/`. 


Поэтому для серьёзной работы под Windows нужно создать нового пользователя с английским именем, например, `Mashenka` и залогиниться из-под него. Переименование старого пользователя не помогает.

### R {#install_R}

...



### Rstudio {#install_Rstudio}

...


### LaTeX {#install_Latex}

...


### git-клиент {#install_git}

...


### Текстовый редактор {#install_editor}

Самое важное: Word --- это не текстовый редактор! Текстовый редактор --- это программа с помощью которой редактируют файлы с текстовым содержимым, а Word сохраняет файлы в специальном формате, где кроме текста сохраняется ещё куча дополнительной информации. Расширение у текстового файла может быть довольно произвольным, `.txt`, `.md`, `.R`, `.tex` и так далее.

Текстовых редакторов много. Я советую кросс-платформенный открытый и бесплатный [Atom](https://atom.io/). 



### STAN {#install_STAN}

...



### jupyter {#install_jupyter}

...


### gretl {#install_gretl}

Тебе страшно? Тебя пугает даже список того, что нужно установить? Ты боишься R, а регрессию надо построить через 5 минут?  Тогда разумное спасение --- это gretl. Для gretl не обязательно учиться программировать: статистические тесты, графики и эконометрические модели доступны через меню. Кроме того, gretl даёт возможность пользователю взаимодействовать с R, что спасает в тех случаях, когда возможностей gretl не хватает.

Естественно, gretl кросс-платформенный открытый и бесплатный, [gretl](http://gretl.sourceforge.net/).


## Весёлый калькулятор {#funny_calc}

...


## Первый скрипт {#first_script}


....

Если текст программы содержит русские или другие неанглийские буквы, например, в комментариях, то при сохранении файла Rstudio предложит выбрать кодировку.


картинка


Кодировка определяет какой конкретно числовой код будет сопоставлен в записанном файле каждой букве. Например, букве `ё` в кодировке UTF-8 сопоставлен десятичный^[Если шестнадцатиричный, то 0451. Ради интереса можно посмотреть сопоставление букв и их кодов в UTF-8, например, на [unicode-table.com](http://unicode-table.com/ru/)] код 1105. 

Для русского языка есть несколько распространённых кодировок: UTF-8 и CP1251. Linux и Macos используют по умолчанию кодировку UTF-8, а вот Windows^[На самом деле всё немного хитрее и сама Windows технически использует UTF-16, а вот многие приложения под ней --- CP1251.] сохраняет простые текстовые файлы в кодировке CP1251.   

Если русскоязычный файл записать в одной кодировке, а пытаться открыть с помощью другой, то мы увидим на экране "кракозябры". Поэтому хорошо, когда все используют одну кодировку. Кодировка UTF-8 более универсальна, чем CP1251. Например, с помощью кодировки UTF-8 в одном тексте можно использовать и русские буквы и французские акценты и китайские иероглифы. 

```{block, type="warning"}
Мы всегда будем использовать кодировку UTF-8.
```



## Установка и подключение пакетов {#packages}

Одна из сильных сторон R --- это открытость: каждая домохозяйка может написать свой пакет для R и выложить его в публичное пользование. Пакеты расширяют возможности R.  Для R написано более 10 тысяч пакетов. Среди них есть и откровенный мусор, и бриллианты, например, `ggplot2`, настолько ценные, что их копируют в другие языки программирования. 



Скорее всего нужный тебе пакет можно найти:

1. В официальном хранилище пакетов R, CRAN.

Здесь пакеты прошли минимальное тестирование. Это отнюдь не гарантия качества пакета, но всё же серьезный давно функционирующий пакет наверняка будет выложен на CRAN.

2. В системе репозиториев github.com.

Здесь, как правило, разработчики публикуют более свежие версии пакетов, ещё не выложенные на CRAN, или молодые пакеты в процессе разработки. 

3. В хранилище пакетов для биологов `bioconductor`.

Это своя отдельная экосистема пакетов R со специальным инсталлятором, блэкджеком и поэтэссами. 

Есть и другие хранилища пакетов, например, R-forge и ..., но они гораздо менее популярны.




Сначала надо определиться, какой пакет тебе нужен. Можно погуглить, можно воспользоваться официальным классификатором пакетов R ....


Чтобы начать использовать какой-нибудь пакет R нужно сделать две вещи. Во-первых, установить его. Установка означает, что пакет будет скачан из Интернета и сохранён в специальной папке на жёстком диске. Установка пакета выполняется один раз. Каждый раз при использовании пакета устанавливать его не нужно. Переустанавливать пакет имеет смысл только если вышла новая его версия. Во-вторых, нужно подключить пакет. Подключение пакета выполняется каждый раз перед его использованием.


С репозитория CRAN пакет ставится командой R:
```{r, eval=FALSE}
install.packages("имя пакета")
```

В Rstudio установить пакет с репозитория CRAN можно через меню: Tools - Install packages. Далее нужно набрать название пакета, можно указать сразу несколько названий через пробел, и нажать `Install`. 

```{block, type="warning"}
Главное при установке пакета --- не бояться сообщений красным цветом! 
```


Любые **сообщения** (messages) R выводит красным цветом и по неопытности их можно принять за ошибку, что скорее всего не так. Ошибка всегда сопровождается словом `r colFmt("Error", "red")`. Если слова `r colFmt("Error", "red")` нет, то всё идёт по плану! 

Почему R использует красный цвет? Потому, что установка пакета --- это потенциально опасное действие, как и установка любой программы. Пакеты на официальном репозитории CRAN проходят определённую проверку, но если ты используешь R для многомиллионных сделок каждый день, то неплохо бы точно знать, что ты ставишь :)




Установить пакет с github.com немногим сложнее. Здесь надо знать не только название пакета, но и название репозитория, где он хранится. Часто название репозитория --- это фамилия автора пакета. Официальной классификации всех пакетов R на github нет, поэтому чтобы понять, какой нужен, остаётся только гуглить.

Кроме того, для установки пакетов с github.com потребуется установить с официального репозитория 




Джентельменский набор пакетов R зависит от сферы деятельности, но практически всем сталкивающимся с анализом данных пригодятся:

...

Очень часто пакеты R ошибочно называют библиотеками. Библиотека --- это папка на жёстком диске компьютера, где хранятся пакеты.

Если пакет установлен, то можно воспользоваться его командами. Если из пакета нужна всего одна команда и один раз, то быстрее указать и нужный пакет, и нужную команду. Например, вызовем команду `qplot` из пакета `ggplot2` и построим гистограмму для случайной выборки из 100 нормальных стандартных случайных величин:
```{r}
x <- rnorm(100) # генерируем случайную выборку из 100 нормальных N(0;1) случайных величин
ggplot2::qplot(x) 
```

Если же ты хочешь использовать команды некоторого пакета много раз, то проще **подключить** пакет командой `library()`. При этом не надо будет каждый раз набирать название пакета и двойное двоеточие. Можно просто использовать команды из этого пакеты:
```{r}
library("ggplot2") # подключаем пакет `ggplot2`

x <- rnorm(100) # генерируем случайную выборку из 100 нормальных N(0;1) случайных величин
y <- x^2 + rnorm(100) 

# строим гистограмму величины x:
qplot(x) + xlab("Величина X") + ylab("Количество значений")
  
# строим диагрраму рассеяния величин x и y:
qplot(x, y) + xlab("Величина X") + ylab("Величина Y")
```

При подключении пакета, как и при его установке, не стоит пугаться сообщений красным шрифтом. Только явное слово `Error` говорит об ошибке. Кроме того, часто можно столкнуться с **предупреждением** (warning) о том, что пакет был создан для более новой версии R. 

`r colFmt("Warning message: package 'xxx' was built under R version 3.3.1", "red")`

Это не страшно. Это означает лишь, что у разработчика пакета `xxx` установлена более свежая версия R, чем у тебя. Обновлять R на своём компьютере при каждом его мелком обновлении, пожалуй, неразумно, но раз в полгода стоит.

```{block, type="warning"}
Правила хорошего тона советуют подключать все нужные пакеты в начале скрипта.
```


## Чтение и запись данных {#io}

Прежде всего неплохо бы знать, где лежит на жёстком диске файл с нужными данными. Напомню, что названия файлов и папок не должны содержать русским букв и пробелов! 

У R есть понятие **рабочей папки** (working folder). В рабочей папке R ищет все требуемые файлы. Одно из простых решений --- указать в качестве рабочей папки ту папку, где лежит нужный файл и далее прочитать его. 

Допустим, нужный нам файл лежит в папке `C:/project_A/data/`. Тогда для установки рабочей папки достаточно выполнить команду:

```{r, eval=FALSE}
setwd("C:/project_A/data/")
```

Вместо этой команды можно воспользоваться меню Rstudio: Session - Set working directory - Choose directory. Далее выбрать нужную папку и нажать `Open`. 

После этого можно прочитать нужный нам файл. Начнём с пакета `rio` позволяющего импортировать данные практически любого типа. На самом деле авторы пакета `rio` просто объединили усилия многих разработчиков в единую команду. И получилось хорошо :)


Хочешь загрузить данные в формате `.csv`? Пожалуйста!
```{r, eval=FALSE}
data <- rio::import("имя_файла.csv")
```

Хочешь загрузить данные в формате `.xlsx`? Пожалуйста!
```{r, eval=FALSE}
data <- rio::import("имя_файла.xlsx")
```

Однако не всегда всё идёт гладко, поэтому остановимся подробнее на разных форматах данных.


## Интернет-источники данных {#internet_sources}

Зачастую данные не обязательно даже сохранять. В R есть пакеты, дающие доступ к некоторым источникам данных в Интернете:

1. `quandl`

2. `quantmod`

3. `WDI`


> СССР --- родина слонов!

Пакеты, дающие доступ к данным по России:

1. `sophisthse` sophist.hse.ru

2. `cbr` Центральный Банк России

3. `datamos` datamos.ru

4. finam.ru.

А эти источники ещё ждут желающих написать пакет для R:

1. gks.ru

2. open data gov ???




## Стиль кода {#code_style}

R одинаково выполнит и команды
```{r, eval=FALSE}
x<-6-7
y<--6+9
x -     y
```

и команды
```{r, eval=FALSE}
x <- 6 - 7
y <- -6 + 9
x - y
```

Однако второй вариант гораздо приятнее для чтения. С тем, кто пишет код как в первом примере, Английская королева рядом не сядет! Чтобы иметь возможность войти в палату Лордов и Общин, тебе следует писать стильный код!


Если ты работаешь в команде, то руководствуйся тем стилем кода, который в ней принят. А для новичков я советую использовать стиль кода, которого придерживается Hadley Wickham, автор очень популярных пакетов R `ggplot2` и `dplyr`:

1. После запятой всегда пиши пробел. Перед запятой --- никогда:

```{r, eval=FALSE}
paste0("Hi ", "guys!")
```


2. Знак присваивания `<-`, знаки арифметических действий (`+`, `-`, `*`), логические проверки (`>`, `<`, `==` и прочие) с двух сторон окружай одинарными пробелами.

```{r, eval=FALSE}
x <- (3.5 + 7) * (2.8 - 9)
```


3. Открывающую фигурную скобку оставляй на старой строке, а закрывающую --- ставь на новую:

```{r, eval=FALSE}
if (x == y) {
  message("Variables x and y are equal.")
}
```


В Rstudio можно включить автоматическую проверку стиля кода в Tools - Global options - Code - Diagnostics. Настоящие сэры и истинные леди в разделе Diagnostics могут проставить все галочки.


## Две записи функций {#two_traditions}

Мы все привыкли к тому, что домохозяйки пишут рецепт в естественном порядке, а математики функции --- в обратном. Сравни:

> Возьмите пепел перьев чёрного петуха

> Добавьте печень дракона

> Варите на медленном огне 2 дня

и

\[
\cos(\sin(|x|))
\]

У домохозяек порядок изложения совпадает с порядком действий. У математиков сначала написано про косинус, но считается он в самом конце. 

Похоже Лёнька Эйлер и Алёшка Клеро 

фото

введя обозначение $f(x)$ отделили математиков от домохозяек и, вероятно, пустили математику по ложному пути. Было бы гораздо удобнее, если бы в математике функции также записывали в естественном порядке! Но обозначение $f(x)$ мы впитали с молоком матери, уже вряд ли что исправишь.


R позволяет использовать обе традиции обозначени.

Традиция Эйлера-Клеро:
```{r}
cos(sin(abs(10)))
```

Для того, чтобы иметь возможность писать операции в естественном порядке, подключаем пакет `dplyr`:
```{r, message=FALSE}
library("dplyr")
```

И теперь в традиции лучших кулинарных рецептов можно написать
```{r}
10 %>% abs() %>% sin() %>% cos()
```

Оператор `%>%` называется трубочкой (pipe). (? канал) По первому впечатлению кажется, что эти трубочки долго писать. Но стоит к ним привыкнуть и ощущаешь, что они безумно удобны для сложных операций!



## Манипуляции с данными  {#data_manipulations}

(здесь про типы данных)

## Графики {#graphs}

...



## У меня ошибка! {#error}

> Шеф! Всё пропало! Гипс снимают, клиент уезжает!

поговори с уточкой, посиди у озера

## Ресурсы по R {#R_links}

Начнём с русскоязычных крупных книжек:

* Шипунов А.Б., Балдин Е.М. и др. [Наглядная статистика. Используем R!](http://ashipunov.info/shipunov/school/books/rbook.pdf)
* Мастицкий С.Э., Шитиков В.К., [Статистический анализ и визуализация с помощью R](http://www.ievbras.ru/ecostat/Kiril/R/Mastitsky%20and%20Shitikov%202014.pdf) 
* Василенко Є.С, [Обробка геологiчної iнформацiї з використанням програмного середовища R](https://www.dropbox.com/sh/gaxtktwbxyuu1ss/AAAb2XW0kquoxfLryf2aYeQZa?dl=0)
* Кабаков Р.И. R в действии. [Анализ и визуализация данных на языке R](http://dmkpress.com/catalog/computer/statistics/978-5-94074-912-7/)

На русском также могут быть полезны:

* Стилевое руководство гугла: [english](https://google-styleguide.googlecode.com/svn/trunk/Rguide.xml), [русский](https://9ccb6b88-a-cba0391b-s-sites.googlegroups.com/a/kiber-guu.ru/r-practice/links/R_style_from_Google.pdf?attachauth=ANoY7crkge5FhA5LZtMwj6Ilur-WbnkKLijkDkoB01VZZAlsFoRjEo7YwgqvW-Gid6ffwBmz3TMT51kMnw8JljZeQlDPRXMKZctirezqTziipn5TOaB9D1IaQ7qzTSusjkIyYV2jMchrhAsXOHTo_G0VRztBxYeecm4HYS19M1VTxn-UluL_9tYpsOEpDvhV1ghlRvk57pCxDO3C4wSV63SQIy0p7cjo6r-HB6Dj0CG7iNKM_RTjaAw%3D&attredirects=0)
* [Блог r-analytics](http://r-analytics.blogspot.ru). На нём есть несколько других подборок русскоязычных ресурсов по R: [раз](http://r-analytics.blogspot.ru/p/blog-page_20.html) и [два](http://r-analytics.blogspot.ru/p/blog-page_80.html).
* [Группа вконтакте rstatistics](https://vk.com/rstatistics)
* [Группа вконтакте spbrug](https://vk.com/spbrug)
* [Группа вконтакте introstats](https://vk.com/introstats)
* Венэбльз, Смит [Введение в R](http://www.ievbras.ru/ecostat/Kiril/R/Biblio/R_rus/Venables%20%c2%e2%e5%e4%e5%ed%e8%e5%20%e2%20R.pdf)
* Зарядов И.С. [Введение в R: часть 1](http://www.ievbras.ru/ecostat/Kiril/R/Biblio/R_rus/%c7%e0%f0%ff%e4%ee%e2%20%f7%e0%f1%f2%fc_1.pdf)
* Зарядов И.С. [Введение в R: часть 2](http://www.ievbras.ru/ecostat/Kiril/R/Biblio/R_rus/%c7%e0%f0%ff%e4%ee%e2%20%f7%e0%f1%f2%fc_2.pdf)
* Борис Демешев [Цикл маленьких заметок по R](http://bdemeshev.github.io/r_cycle/)

Вопросы и ответы:

* [stackoverflow](http://stackoverflow.com/) Если возникли проблемы с программированием в R (и не только в R), а документация уже прочитана...
* [stats.stackexchange](http://stats.stackexchange.com/) Можно спросить по статистическим методам и их реализации в R. 
* [tex.stackexchange](http://tex.stackexchange.com/) Вопросы и ответы про LaTeX



Он-лайн курсы и видеолекции с использованием R:

* [Try R](http://tryr.codeschool.com/) Путь к сокровищам R для самых начинающих пиRатов!

* [datacamp.com](https://www.datacamp.com/) Несколько платных и бесплатных интерактивных курсов по R

* Видео-лекции курса Computing for Data Analysis: [неделя 1](http://www.youtube.com/playlist?list=PLjTlxb-wKvXNSDfcKPFH2gzHGyjpeCZmJ), [неделя 2](http://www.youtube.com/playlist?list=PLjTlxb-wKvXNnjUTX4C8IeIhPBjPkng6B), [неделя 3](http://www.youtube.com/playlist?list=PLjTlxb-wKvXOzI2h0F2_rYZHIXz8GWBop), [неделя 4](http://www.youtube.com/playlist?list=PLjTlxb-wKvXOdzysAE6qrEBN_aSBC0LZS). Сам курс доступен на [coursera.org](http://www.coursera.org)


Открытые крупные источники на английском:

* Trevor Hastie, Robert Tibshirani, [An Introduction to Statistical Learning](http://www-bcf.usc.edu/~gareth/ISL/). По книжке есть [курс на платформе class.standford.edu](https://class.stanford.edu/courses/HumanitiesandScience/StatLearning/Winter2015/about)

* Rob Hyndman, [Forecasting: principles and practice](https://www.otexts.org/book/fpp) Книжка по временным рядам от автора пакета forecast

* Garrett Grolemund, Hadley Wickham, [R for Data Science](http://r4ds.had.co.nz/)

* Colin Gillespie, Robin Lovelace, [Efficient R programming](https://bookdown.org/csgillespie/efficientR), он-лайн книга для более продвинутых пользователей R. Написана на R и markdown :)

* Rob Kabacoff, [Quick R](http://www.statmethods.net/)

* Farnsworth, [Econometrics in R](http://cran.r-project.org/doc/contrib/Farnsworth-EconometricsInR.pdf)

* [Cookbook for R](http://wiki.stdout.org/rcookbook/)

* [R-inferno](http://www.burns-stat.com/pages/Tutor/R_inferno.pdf) Адский учебник по R с картинками Ботичелли, "Even if it doesn't help you with your problem, it might amuse you"


* Roger Peng, [R programming for data science](https://leanpub.com/rprogramming/) и на [bookdown](https://bookdown.org/rdpeng/rprogdatascience/)

* [Introduction to R](http://cran.r-project.org/doc/manuals/R-intro.pdf), Введение с официального сайта

* документация [по графикам ggplot2](http://docs.ggplot2.org/current/index.html)

* документация к [R от stats.stackexchange](http://stackoverflow.com/documentation/r/topics)

* **Шикарные** [**шпаргалки от Rstudio**](https://www.rstudio.com/resources/cheatsheets/)

* [100 курсов и книг по R](https://pairach.com/2012/02/26/r-tutorials-from-universities-around-the-world/) от разных университетов

* Агрегатор блогов [r-bloggers](http://r-bloggers.com/)

* Поисковик [rseek.org](http://rseek.org/)


Великолепные виньетки к разным пакетам:

* [vars](http://cran.r-project.org/web/packages/vars/vignettes/vars.pdf), векторные авторегрессии, есть вольный пересказ [по-русски](http://rpubs.com/rakhab/9941) 
* [dplyr](http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html) манипуляции с данными
* [sandwich](http://cran.r-project.org/web/packages/sandwich/vignettes/sandwich.pdf) борьба с гетероскедастичностью и заклинания HC0, HC1, HC2, ...
* [plm](http://cran.r-project.org/web/packages/plm/vignettes/plm.pdf) панельные модели в R 
* [ggmap](http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf) рисуем карты
* [vcd](http://cran.r-project.org/web/packages/vcd/vignettes/strucplot.pdf) полезные графики для качественных переменных
* [Beanplot](http://www.jstatsoft.org/v28/c01/paper): A Boxplot Alternative for Visual Comparison of Distributions.



Ты ещё не заработал свой первый миллион и хочешь скачать научную статью или книжку бесплатно?

* Научные книги можно найти на [gen.lib.rus.ec](http://gen.lib.rus.ec/).

* Научные статьи можно скачать на [sci-hub.cc](http://sci-hub.cc/). Есть даже бот `@scihubot` для [Telegram](https://telegram.org/), которые вышлет в ответ на запрос полный текст статьи. 


Если какая-нибудь ссылка не работает или хочешь предложить свою, [смело открывай issue на github](https://github.com/bdemeshev/r_manual_book/issues)!

